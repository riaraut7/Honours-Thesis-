# Load the necessary libraries
library(raster)
library(sp)
library(dplyr)
#lets load your packages first
library(stringr)
library(V.PhyloMaker)
library(tidyverse)
library(TNRS)
library(beepr)
library(taxize)
library(geiger)
library(ggtree)
#Here is your dataset with curve Id, species, breadth, topt, and lat/long values
starting_dataset <- read.csv('final_curve_parameter_filter_2_info.csv', stringsAsFactors = TRUE)
update_taxon = function(data) {
data$Name_submitted = tolower(data$Taxon) # Set taxon names to all lower case - prevents problems
query_data = unique(data$Name_submitted)  # Extract unique names to prevent too many queries
resolved_taxa = TNRS(query_data)    # Query TNRS with species list, get correct names
resolved_taxa[resolved_taxa$Name_matched == "[No match found]",]$Name_matched = str_to_sentence(resolved_taxa[resolved_taxa$Name_matched == "[No match found]",]$Name_submitted)
data = resolved_taxa %>%                      # Grab dataframe with corrected and submitted names
select(Name_submitted, Name_matched) %>%    # Select only the columns we're interested in
merge(data, by = "Name_submitted") %>%      # Merge results dataframe with corrected names dataframe
mutate(Taxon = Name_matched) %>%            # Add new column Taxon with corrected name
select(-Name_submitted, -Name_matched) %>%  # Remove extra columns leaving only the corrected Taxon
arrange(Taxon)                            # Sort by curveID to put back in original order
return(data)
}
updated_taxon_dataset <- update_taxon(starting_dataset)
